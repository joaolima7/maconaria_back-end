// Code generated by Wire. DO NOT EDIT.

//go:generate go run -mod=mod github.com/google/wire/cmd/wire
//go:build !wireinject
// +build !wireinject

package di

import (
	"database/sql"
	"github.com/go-chi/chi/v5"
	"github.com/google/wire"
	"github.com/joaolima7/maconaria_back-end/config"
	"github.com/joaolima7/maconaria_back-end/internal/data/repositories/post"
	"github.com/joaolima7/maconaria_back-end/internal/data/repositories/user"
	"github.com/joaolima7/maconaria_back-end/internal/domain/repositories/post"
	user2 "github.com/joaolima7/maconaria_back-end/internal/domain/repositories/user"
	"github.com/joaolima7/maconaria_back-end/internal/domain/usecases/post_usecase"
	"github.com/joaolima7/maconaria_back-end/internal/domain/usecases/user_usecase"
	"github.com/joaolima7/maconaria_back-end/internal/infra/database"
	"github.com/joaolima7/maconaria_back-end/internal/infra/web/auth"
	"github.com/joaolima7/maconaria_back-end/internal/infra/web/handlers"
	"github.com/joaolima7/maconaria_back-end/internal/infra/web/middlewares"
	"github.com/joaolima7/maconaria_back-end/internal/infra/web/routes"
	"github.com/joaolima7/maconaria_back-end/internal/infra/web/server"
)

// Injectors from wire.go:

func InitializeApp(cfg *config.Config) (*App, error) {
	db, err := database.ProvideDatabase(cfg)
	if err != nil {
		return nil, err
	}
	queries := database.ProvideQueries(db)
	createUserRepositoryImpl := user.NewCreateUserRepositoryImpl(queries)
	createUserUseCase := user_usecase.NewCreateUserUseCase(createUserRepositoryImpl)
	getAllUsersRepositoryImpl := user.NewGetAllUsersRepositoryImpl(queries)
	getAllUsersUseCase := user_usecase.NewGetAllUsersUseCase(getAllUsersRepositoryImpl)
	updateUserByIDRepositoryImpl := user.NewUpdateUserByIDRepositoryImpl(queries)
	updateUserByIdUseCase := user_usecase.NewUpdateUserByIdUseCase(updateUserByIDRepositoryImpl)
	updateUserPasswordRepositoryImpl := user.NewUpdateUserPasswordRepositoryImpl(queries)
	getUserByIdRepositoryImpl := user.NewGetUserByIdRepositoryImpl(queries)
	updateUserPasswordUseCase := user_usecase.NewUpdateUserPasswordUseCase(updateUserPasswordRepositoryImpl, getUserByIdRepositoryImpl)
	getUserByIdUseCase := user_usecase.NewGetUserByIdUseCase(getUserByIdRepositoryImpl)
	userHandler := handlers.NewUserHandler(createUserUseCase, getAllUsersUseCase, updateUserByIdUseCase, updateUserPasswordUseCase, getUserByIdUseCase)
	getUserByEmailRepositoryImpl := user.NewGetUserByEmailRepositoryImpl(queries)
	jwtService := provideJWTService(cfg)
	loginUseCase := user_usecase.NewLoginUseCase(getUserByEmailRepositoryImpl, jwtService)
	authHandler := handlers.NewAuthHandler(loginUseCase)
	postImageRepositoryImpl := post.NewPostImageRepositoryImpl(queries)
	createPostRepositoryImpl := post.NewCreatePostRepositoryImpl(queries, postImageRepositoryImpl)
	createPostUseCase := post_usecase.NewCreatePostUseCase(createPostRepositoryImpl, getUserByIdRepositoryImpl)
	getAllPostsRepositoryImpl := post.NewGetAllPostsRepositoryImpl(queries, postImageRepositoryImpl)
	getAllPostsUseCase := post_usecase.NewGetAllPostsUseCase(getAllPostsRepositoryImpl)
	updatePostByIDRepositoryImpl := post.NewUpdatePostByIDRepositoryImpl(queries, postImageRepositoryImpl)
	updatePostByIDUseCase := post_usecase.NewUpdatePostByIDUseCase(updatePostByIDRepositoryImpl)
	deletePostRepositoryImpl := post.NewDeletePostRepositoryImpl(queries)
	deletePostUseCase := post_usecase.NewDeletePostUseCase(deletePostRepositoryImpl)
	postHandler := handlers.NewPostHandler(createPostUseCase, getAllPostsUseCase, updatePostByIDUseCase, deletePostUseCase)
	healthHandler := handlers.NewHealthHandler(db)
	authMiddleware := middlewares.NewAuthMiddleware(jwtService)
	router := routes.NewRouter(userHandler, authHandler, postHandler, healthHandler, authMiddleware)
	mux := provideChiRouter(router)
	server := provideServer(mux, cfg)
	app := &App{
		Server: server,
		DB:     db,
	}
	return app, nil
}

// wire.go:

// User Repository Set
var UserRepositorySet = wire.NewSet(user.NewCreateUserRepositoryImpl, wire.Bind(new(user2.CreateUserRepository), new(*user.CreateUserRepositoryImpl)), user.NewGetAllUsersRepositoryImpl, wire.Bind(new(user2.GetAllUsersRepository), new(*user.GetAllUsersRepositoryImpl)), user.NewGetUserByEmailRepositoryImpl, wire.Bind(new(user2.GetUserByEmailRepository), new(*user.GetUserByEmailRepositoryImpl)), user.NewGetUserByIdRepositoryImpl, wire.Bind(new(user2.GetUserByIdRepository), new(*user.GetUserByIdRepositoryImpl)), user.NewUpdateUserByIDRepositoryImpl, wire.Bind(new(user2.UpdateUserByIDRepository), new(*user.UpdateUserByIDRepositoryImpl)), user.NewUpdateUserPasswordRepositoryImpl, wire.Bind(new(user2.UpdateUserPasswordRepository), new(*user.UpdateUserPasswordRepositoryImpl)))

// Post Repository Set
var PostRepositorySet = wire.NewSet(post.NewPostImageRepositoryImpl, wire.Bind(new(post_repository.PostImageRepository), new(*post.PostImageRepositoryImpl)), post.NewCreatePostRepositoryImpl, wire.Bind(new(post_repository.CreatePostRepository), new(*post.CreatePostRepositoryImpl)), post.NewGetAllPostsRepositoryImpl, wire.Bind(new(post_repository.GetAllPostsRepository), new(*post.GetAllPostsRepositoryImpl)), post.NewUpdatePostByIDRepositoryImpl, wire.Bind(new(post_repository.UpdatePostByIDRepository), new(*post.UpdatePostByIDRepositoryImpl)), post.NewDeletePostRepositoryImpl, wire.Bind(new(post_repository.DeletePostRepository), new(*post.DeletePostRepositoryImpl)))

// User UseCase Set
var UserUseCaseSet = wire.NewSet(user_usecase.NewCreateUserUseCase, user_usecase.NewGetAllUsersUseCase, user_usecase.NewGetUserByIdUseCase, user_usecase.NewUpdateUserByIdUseCase, user_usecase.NewUpdateUserPasswordUseCase, user_usecase.NewLoginUseCase)

// Post UseCase Set
var PostUseCaseSet = wire.NewSet(post_usecase.NewCreatePostUseCase, post_usecase.NewGetAllPostsUseCase, post_usecase.NewUpdatePostByIDUseCase, post_usecase.NewDeletePostUseCase)

// Infra Set
var InfraSet = wire.NewSet(database.ProvideDatabase, database.ProvideQueries, provideJWTService)

// Web Set
var WebSet = wire.NewSet(handlers.NewUserHandler, handlers.NewAuthHandler, handlers.NewPostHandler, handlers.NewHealthHandler, middlewares.NewAuthMiddleware, routes.NewRouter, provideChiRouter,
	provideServer,
)

func provideJWTService(cfg *config.Config) *auth.JWTService {
	return auth.NewJWTService(cfg.JWTSecret, cfg.GetJWTDuration())
}

func provideChiRouter(router *routes.Router) *chi.Mux {
	return router.Setup()
}

func provideServer(router *chi.Mux, cfg *config.Config) *server.Server {
	return server.NewServer(router, cfg.ServerPort)
}

type App struct {
	Server *server.Server
	DB     *sql.DB
}

func (a *App) Cleanup() {
	if a.DB != nil {
		a.DB.Close()
	}
}
